<!DOCTYPE html>
<html>
<head>
  <!-- ... (Your existing head content) ... -->
</head>
<body>

  <!-- ... (Your existing body content) ... -->

  <!-- Load Single-Threaded OpenCV.js -->
  <script async src="https://docs.opencv.org/4.x/opencv.js" type="text/javascript"></script>
  
  <!-- FFmpeg.wasm -->
  <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>

  <script>
    // Check for SharedArrayBuffer availability
    if (typeof SharedArrayBuffer === 'undefined') {
      alert('SharedArrayBuffer is not available in your browser. Processing functionality may be limited.');
    }

    // Star animation code
    // ... (Your existing star animation code) ...

    // Modal functionality
    // ... (Your existing modal functionality code) ...

    // Processing Logic
    const { createFFmpeg, fetchFile } = FFmpeg;
    const ffmpeg = createFFmpeg({
      log: true,
      corePath: 'https://unpkg.com/@ffmpeg/core@0.11.6/dist/ffmpeg-core.js'
    });
    let isFFmpegLoaded = false;

    // ... (Rest of your JavaScript code) ...

    // Initialize FFmpeg
    async function initFFmpeg() {
      if (!isFFmpegLoaded) {
        try {
          await ffmpeg.load();
          isFFmpegLoaded = true;
          console.log('FFmpeg loaded successfully');
        } catch (error) {
          console.error('Failed to load FFmpeg:', error);
          alert('FFmpeg failed to load. Please ensure your browser supports WebAssembly and SharedArrayBuffer.');
        }
      }
    }

    // Function to Process Images Using OpenCV.js
    async function processImage(file) {
      return new Promise((resolve, reject) => {
        if (typeof cv === 'undefined') {
          reject(new Error('OpenCV.js is not loaded. Image processing is unavailable.'));
          return;
        }
        // ... (Rest of your image processing code) ...
      });
    }

    // ... (Rest of your JavaScript code, including processVideo and event handlers) ...

  </script>
  
</body>
</html>
